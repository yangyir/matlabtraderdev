codes_oi = {
    'OI1109';...
    'OI1201';'OI1205';'OI1209';...
    'OI1301';'OI1305';'OI1309';...
    'OI1401';'OI1405';'OI1409';...
    'OI501';'OI505';'OI509';...
    'OI601';'OI605';'OI609';...
    'OI701';'OI705';'OI709';...
    'OI801';'OI805';'OI809';...
    'OI901';'OI905';'OI909';...
    'OI001';'OI005';'OI009';...
    'OI101';'OI105';'OI109';...
    'OI201';'OI205';'OI209';...
    'OI301';'OI305';'OI309';...
    'OI401';...
};
%
codes_p = {
    'p0805';'p0809';...
    'p0901';'p0905';'p0909';...
    'p1001';'p1005';'p1009';...
    'p1101';'p1105';'p1109';...
    'p1201';'p1205';'p1209';...
    'p1301';'p1305';'p1309';...
    'p1401';'p1405';'p1409';...
    'p1501';'p1505';'p1509';...
    'p1601';'p1605';'p1609';...
    'p1701';'p1705';'p1709';...
    'p1801';'p1805';'p1809';...
    'p1901';'p1905';'p1909';...
    'p2001';'p2005';'p2009';...
    'p2101';'p2105';'p2109';...
    'p2201';'p2205';'p2209';...
    'p2301';'p2305';'p2309';...
    'p2401';...
};
%
codes_y = {
    'y0609';'y0611';...
    'y0701';'y0705';'y0709';...
    'y0801';'y0805';'y0809';...
    'y0901';'y0905';'y0909';...
    'y1001';'y1005';'y1009';...
    'y1101';'y1105';'y1109';...
    'y1201';'y1205';'y1209';...
    'y1301';'y1305';'y1309';...
    'y1401';'y1405';'y1409';...
    'y1501';'y1505';'y1509';...
    'y1601';'y1605';'y1609';...
    'y1701';'y1705';'y1709';...
    'y1801';'y1805';'y1809';...
    'y1901';'y1905';'y1909';...
    'y2001';'y2005';'y2009';...
    'y2101';'y2105';'y2109';...
    'y2201';'y2205';'y2209';...
    'y2301';'y2305';'y2309';...
    'y2401';...
};
%
codes_m = {
    'm0101';'m0105';'m0109';...
    'm0201';'m0205';'m0209';...
    'm0301';'m0305';'m0309';...
    'm0401';'m0405';'m0409';...
    'm0501';'m0505';'m0509';...
    'm0601';'m0605';'m0609';...
    'm0701';'m0705';'m0709';...
    'm0801';'m0805';'m0809';...
    'm0901';'m0905';'m0909';...
    'm1001';'m1005';'m1009';...
    'm1101';'m1105';'m1109';...
    'm1201';'m1205';'m1209';...
    'm1301';'m1305';'m1309';...
    'm1401';'m1405';'m1409';...
    'm1501';'m1505';'m1509';...
    'm1601';'m1605';'m1609';...
    'm1701';'m1705';'m1709';...
    'm1801';'m1805';'m1809';...
    'm1901';'m1905';'m1909';...
    'm2001';'m2005';'m2009';...
    'm2101';'m2105';'m2109';...
    'm2201';'m2205';'m2209';...
    'm2301';'m2305';'m2309';...
    'm2401';...
};
%
codes_rm = {
    'RM1309';...
    'RM1401';'RM1405';'RM1409';...
    'RM1501';'RM505';'RM1509';...
    'RM1601';'RM1605';'RM1609';...
    'RM1701';'RM1705';'RM1709';...
    'RM1801';'RM1805';'RM1809';...
    'RM1901';'RM1905';'RM1909';...
    'RM001';'RM005';'RM009';...
    'RM101';'RM105';'RM109';...
    'RM201';'RM205';'RM209';...
    'RM301';'RM305';'RM309';...
    'RM401';...
    };
%
codes_a = {
    'a0009';...
    'a0101';'a0105';'a0107';'a0109';...
    'a0201';'a0205';'a0207';'a0209';'a0211';...
    'a0301';'a0303';'a0305';'a0307';'a0309';'a0311';...
    'a0401';'a0405';'a0409';'a0411';...
    'a0501';'a0505';'a0509';'a0511';...
    'a0601';'a0605';'a0609';...
    'a0701';'a0705';'a0709';...
    'a0801';'a0805';'a0809';...
    'a0901';'a0905';'a0909';...
    'a1001';'a1005';'a1009';...
    'a1101';'a1105';'a1109';...
    'a1201';'a1205';'a1209';...
    'a1301';'a1305';'a1309';...
    'a1401';'a1405';'a1409';...
    'a1501';'a1505';'a1509';...
    'a1601';'a1605';'a1609';...
    'a1701';'a1705';'a1709';...
    'a1801';'a1805';'a1809';...
    'a1901';'a1905';'a1909';...
    'a2001';'a2005';'a2009';...
    'a2101';'a2105';'a2109';'a2111';...
    'a2201';'a2203';'a2205';'a2207';'a2209';'a2211';...
    'a2301';'a2305';'a2307';'a2309';'a2311';...
    'a2401';...
};
%
codes_grease = [codes_oi;codes_p;codes_y;codes_m;codes_rm;codes_a];
output_grease_d = fractal_kelly_summary('codes',codes_grease,'frequency','daily','usefractalupdate',0,'usefibonacci',1,'direction','both');
%%
[tc_grease_d,tb_grease_d,tbl_grease_d,k_l_grease_d,k_s_grease_d,tblbyasset_l_grease_d,tblbyasset_s_grease_d] = kellydistrubitionsummary(output_grease_d);
%%
signal_l_valid_grease = k_l_grease_d.opensignal_unique_l(logical(k_l_grease_d.use_unique_l));
signal_s_valid_grease = k_s_grease_d.opensignal_unique_s(logical(k_s_grease_d.use_unique_s));
assetlist_grease = unique([tblbyasset_l_grease_d.assetlist;tblbyasset_s_grease_d.assetlist]);
nasset = size(assetlist_grease,1);
%
WMat_L_grease_d = zeros(length(signal_l_valid_grease),nasset);
RMat_L_grease_d = WMat_L_grease_d;
KMat_L_grease_d = WMat_L_grease_d;
for i = 1:length(signal_l_valid_grease)
    for j = 1:nasset
        ret = kellyempirical('distribution',output_grease_d,'assetname',assetlist_grease{j},'direction','l','signalname',signal_l_valid_grease{i});
        WMat_L_grease_d(i,j) = ret.W;
        RMat_L_grease_d(i,j) = ret.R;
        KMat_L_grease_d(i,j) = ret.K;
    end
end
%
WMat_S_grease_d = zeros(length(signal_s_valid_grease),nasset);
RMat_S_grease_d = WMat_S_grease_d;
KMat_S_grease_d = WMat_S_grease_d;
for i = 1:length(signal_s_valid_grease)
    for j = 1:nasset
        ret = kellyempirical('distribution',output_grease_d,'assetname',assetlist_grease{j},'direction','s','signalname',signal_s_valid_grease{i});
        WMat_S_grease_d(i,j) = ret.W;
        RMat_S_grease_d(i,j) = ret.R;
        KMat_S_grease_d(i,j) = ret.K;
    end
end
%
%%
strat_daily_grease = struct('tblbyasset_l',tblbyasset_l_grease_d,...
    'tblbyasset_s',tblbyasset_s_grease_d,...
    'kelly_table_l',k_l_grease_d,...
    'kelly_table_s',k_s_grease_d,...
    tc_grease_d{1}.name,tc_grease_d{1}.table,...
    tc_grease_d{2}.name,tc_grease_d{2}.table,...
    tc_grease_d{3}.name,tc_grease_d{3}.table,...
    tc_grease_d{4}.name,tc_grease_d{4}.table,...
    'breachuplvlup_tb',tb_grease_d{1}.table,...
    'breachdnlvldn_tb',tb_grease_d{2}.table,...
    'breachupsshighvalue_tb',tb_grease_d{3}.table,...
    'breachdnbshighvalue_tb',tb_grease_d{4}.table,...
    'breachuplvlup_tc',tc_grease_d{5}.table,...
    'breachdnlvldn_tc',tc_grease_d{6}.table,...
    'breachupsshighvalue_tc',tc_grease_d{7}.table,...
    'breachdnbshighvalue_tc',tc_grease_d{8}.table,...
    'breachuphighsc13',tc_grease_d{9}.table,...
    'breachdnlowbc13',tc_grease_d{10}.table,...
    'kelly_matrix_l',KMat_L_grease_d,...
    'kelly_matrix_s',KMat_S_grease_d,...
    'winprob_matrix_l',WMat_L_grease_d,...
    'winprob_matrix_s',WMat_S_grease_d,...
    'signal_l',{signal_l_valid_grease},...
    'signal_s',{signal_s_valid_grease},...
    'asset_list',{assetlist_grease'});
%%
dir_ = [getenv('onedrive'),'\fractal backtest\kelly distribution\matlab\grease\'];
save([dir_,'strat_daily_grease.mat'],'strat_daily_grease');
fprintf('file saved...\n');
