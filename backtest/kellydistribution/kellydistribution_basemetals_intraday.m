%%
codes_cu = {
    'cu2001';'cu2002';'cu2003';'cu2004';'cu2005';'cu2006';'cu2007';'cu2008';'cu2009';'cu2010';'cu2011';'cu2012';...
    'cu2101';'cu2102';'cu2103';'cu2104';'cu2105';'cu2106';'cu2107';'cu2108';'cu2109';'cu2110';'cu2111';'cu2112';...
    'cu2201';'cu2202';'cu2203';'cu2204';'cu2205';'cu2206';'cu2207';'cu2208';'cu2209';'cu2210';'cu2211';'cu2212';...
    'cu2301';'cu2302';'cu2303';'cu2304';'cu2305';'cu2306';'cu2307';'cu2308';'cu2309';'cu2310';'cu2311';'cu2312';...
    };
%
codes_al = {
    'al2001';'al2002';'al2003';'al2004';'al2005';'al2006';'al2007';'al2008';'al2009';'al2010';'al2011';'al2012';...
    'al2101';'al2102';'al2103';'al2104';'al2105';'al2106';'al2107';'al2108';'al2109';'al2110';'al2111';'al2112';...
    'al2201';'al2202';'al2203';'al2204';'al2205';'al2206';'al2207';'al2208';'al2209';'al2210';'al2211';'al2212';...
    'al2301';'al2302';'al2303';'al2304';'al2305';'al2306';'al2307';'al2308';'al2309';'al2310';'al2311';'al2312';...
    };
%
codes_zn = {
    'zn2001';'zn2002';'zn2003';'zn2004';'zn2005';'zn2006';'zn2007';'zn2008';'zn2009';'zn2010';'zn2011';'zn2012';...
    'zn2101';'zn2102';'zn2103';'zn2104';'zn2105';'zn2106';'zn2107';'zn2108';'zn2109';'zn2110';'zn2111';'zn2112';...
    'zn2201';'zn2202';'zn2203';'zn2204';'zn2205';'zn2206';'zn2207';'zn2208';'zn2209';'zn2210';'zn2211';'zn2212';...
    'zn2301';'zn2302';'zn2303';'zn2304';'zn2305';'zn2306';'zn2307';'zn2308';'zn2309';'zn2310';'zn2311';'zn2312';...
    };
%
codes_pb = {
    'pb2001';'pb2002';'pb2003';'pb2004';'pb2005';'pb2006';'pb2007';'pb2008';'pb2009';'pb2010';'pb2011';'pb2012';...
    'pb2101';'pb2102';'pb2103';'pb2104';'pb2105';'pb2106';'pb2107';'pb2108';'pb2109';'pb2110';'pb2111';'pb2112';...
    'pb2201';'pb2202';'pb2203';'pb2204';'pb2205';'pb2206';'pb2207';'pb2208';'pb2209';'pb2210';'pb2211';'pb2212';...
    'pb2301';'pb2302';'pb2303';'pb2304';'pb2305';'pb2306';'pb2307';'pb2308';'pb2309';'pb2310';'pb2311';'pb2312';...
    };
%
codes_ni = {
    'ni2002';'ni2003';'ni2004';'ni2005';'ni2006';'ni2007';'ni2008';'ni2009';'ni2010';'ni2011';'ni2012';...
    'ni2101';'ni2102';'ni2103';'ni2104';'ni2106';'ni2107';'ni2108';'ni2109';'ni2110';'ni2111';'ni2112';...
    'ni2201';'ni2202';'ni2203';'ni2204';'ni2205';'ni2206';'ni2207';'ni2208';'ni2209';'ni2210';'ni2211';'ni2212';...
    'ni2301';'ni2302';'ni2303';'ni2304';'ni2305';'ni2306';'ni2307';'ni2308';'ni2309';'ni2310';'ni2311';'ni2312';...
    };
%
codes_sn = {
    'sn2106';'sn2107';'sn2108';'sn2109';'sn2110';'sn2111';'sn2112';...
    'sn2201';'sn2202';'sn2203';'sn2205';'sn2206';'sn2207';'sn2208';'sn2209';'sn2210';'sn2211';'sn2212';...
    'sn2301';'sn2302';'sn2303';'sn2304';'sn2305';'sn2306';'sn2307';'sn2308';'sn2309';'sn2310';'sn2311';'sn2312';...
    };
%
output_basemetals = fractal_kelly_summary('codes',[codes_cu;codes_al;codes_zn;codes_pb;codes_ni;codes_sn],'frequency','intraday','usefractalupdate',0,'usefibonacci',1,'direction','both');
%%
[tc_basemetals_i,tb_basemetals_i,tbl_basemetals_i,k_l_basemetals_i,k_s_basemetals_i,tblbyasset_l_basemetals_i,tblbyasset_s_basemetals_i] = kellydistrubitionsummary(output_basemetals);
%%
signal_l_valid_basemetals = k_l_basemetals_i.opensignal_unique_l(logical(k_l_basemetals_i.use_unique_l));
signal_s_valid_basemetals = k_s_basemetals_i.opensignal_unique_s(logical(k_s_basemetals_i.use_unique_s));
assetlist_basemetals = unique([tblbyasset_l_basemetals_i.assetlist;tblbyasset_s_basemetals_i.assetlist]);
nasset = size(assetlist_basemetals,1);
%
WMat_L_basemetals_i = zeros(length(signal_l_valid_basemetals),nasset);
RMat_L_basemetals_i = WMat_L_basemetals_i;
KMat_L_basemetals_i = WMat_L_basemetals_i;
for i = 1:length(signal_l_valid_basemetals)
    for j = 1:nasset
        ret = kellyempirical('distribution',output_basemetals,'assetname',assetlist_basemetals{j},'direction','l','signalname',signal_l_valid_basemetals{i});
        WMat_L_basemetals_i(i,j) = ret.W;
        RMat_L_basemetals_i(i,j) = ret.R;
        KMat_L_basemetals_i(i,j) = ret.K;
    end
end
%
WMat_S_basemetals_i = zeros(length(signal_s_valid_basemetals),nasset);
RMat_S_basemetals_i = WMat_S_basemetals_i;
KMat_S_basemetals_i = WMat_S_basemetals_i;
for i = 1:length(signal_s_valid_basemetals)
    for j = 1:nasset
        ret = kellyempirical('distribution',output_basemetals,'assetname',assetlist_basemetals{j},'direction','s','signalname',signal_s_valid_basemetals{i});
        WMat_S_basemetals_i(i,j) = ret.W;
        RMat_S_basemetals_i(i,j) = ret.R;
        KMat_S_basemetals_i(i,j) = ret.K;
    end
end
%
%%
strat_intraday_basemetals = struct('tblbyasset_l',tblbyasset_l_basemetals_i,...
    'tblbyasset_s',tblbyasset_s_basemetals_i,...
    'kelly_table_l',k_l_basemetals_i,...
    'kelly_table_s',k_s_basemetals_i,...
    tc_basemetals_i{1}.name,tc_basemetals_i{1}.table,...
    tc_basemetals_i{2}.name,tc_basemetals_i{2}.table,...
    tc_basemetals_i{3}.name,tc_basemetals_i{3}.table,...
    tc_basemetals_i{4}.name,tc_basemetals_i{4}.table,...
    'breachuplvlup_tb',tb_basemetals_i{1}.table,...
    'breachdnlvldn_tb',tb_basemetals_i{2}.table,...
    'breachupsshighvalue_tb',tb_basemetals_i{3}.table,...
    'breachdnbshighvalue_tb',tb_basemetals_i{4}.table,...
    'breachuplvlup_tc',tc_basemetals_i{5}.table,...
    'breachdnlvldn_tc',tc_basemetals_i{6}.table,...
    'breachupsshighvalue_tc',tc_basemetals_i{7}.table,...
    'breachdnbshighvalue_tc',tc_basemetals_i{8}.table,...
    'breachuphighsc13',tc_basemetals_i{9}.table,...
    'breachdnlowbc13',tc_basemetals_i{10}.table,...
    'kelly_matrix_l',KMat_L_basemetals_i,...
    'kelly_matrix_s',KMat_S_basemetals_i,...
    'winprob_matrix_l',WMat_L_basemetals_i,...
    'winprob_matrix_s',WMat_S_basemetals_i,...
    'signal_l',{signal_l_valid_basemetals},...
    'signal_s',{signal_s_valid_basemetals},...
    'asset_list',{assetlist_basemetals'});
%%
dir_ = [getenv('onedrive'),'\fractal backtest\kelly distribution\matlab\basemetals\'];
save([dir_,'strat_intraday_basemetals.mat'],'strat_intraday_basemetals');
fprintf('file saved...\n');
